# 가상 메모리
- 메모리 크기보다 더 큰 기억공간이 필요한 프로세스를 실행할 수 있게 하는 방법  
- 해당 프로세스의 특정구간만 메모리에 담아서 당장 필요한 부분부터 처리한다.
- 프로세스에 의해 참조되는 **가상주소**를 메모리에서 사용하는 **실주소**와 분리하여 구분함
- 메모리에 실제로 적재될 때는 가상주소를 실주소로 매핑되어 사용함

### 사상
프로세스 실행을 위해 가상주소를 실주소로 변환(매핑)하는 것
- 동적 주소 변환(DAT): 프로세스가 실행되는 동안 사상
- 인위적 연속성이 보장됨
:::tip 인위적 연속성이란?
가상주소 공간에서는 연속이지만 실주소 공간에서는 연속일 필요가 없음
:::

## 블록 단위 주소 변환
- 블록 단위로 분류하여 각 블록이 메모리의 어디에 위치하는지를 관리
- 블록이 작아지면 사상정보 커짐
- 블록이 커지면 블록 전송시간도 증가 및 적재할 프로세스 수 감소

### 블록 구성 방식에 따른 분류
- **페이징 기법**: 블록의 크기가 동일한 페이지로 구성
- **세그먼테이션 기법**: 블록의 크기가 서로 다른 세그먼트로 구성

## 페이징 기법
- 가상 메모리를 고정된 크기의 블록인 페이지 단위로 나누어 관리함
:::tip 용어
- 페이지: 가상 메모리의 블록
- 페이지 프레임: 실제 메모리의 블록

페이지와 페이지 프레임의 블록의 크기는 동일하다.
:::

### 페이징 기법의 특징
- 논리적 의미와 무관하게 동일 크기의 페이지로 가상 메모리를 나눔
- 프로세스 사이의 메모리 보호는 페이지 단위로 이루어짐
- 페이지 덕분에 외부 단편화는 발생하지 않으나, 페이지 크기보다 적재되는 메모리가 작을 경우 내부 단편화가 발생할 수 있음

### 페이지 사상표
가상주소를 실주소로 동적 변환하기 위해 필요함.  
가상 주소의 페이지 번호에 대한 실주소의 페이지 프레임 번호를 저장함.  
**페이지 존재 비트, 보조기억장치 주소, 페이지 프레임 번호**로 이루어져 있음.  

| 페이지 번호 | 페이지 존재 비트 | 보조기억장치 | 페이지 프레임 번호 |
| :--------: | :-------------: | :---------: | :--------------: |
|    3       |      1          |    s        |    5             |
|    ...     |      ...        |    ...      |    ...           |

  
<br>

- **직접 사상** : 페이지 사상표를 직접 이용하는 방법
- **연관 사상** : 연관기억장치에 저장한 연관 사상표를 이용하는 방법.
:::tip 용어
- **페이지 존재 비트**: 1일 경우 메모리상에 적재되어 있는 상태. 0이면 적재가 안된 상태
- **연관기억장치**: 저장된 값으로 데이터를 엑세스하는 고속 메모리 장치
- **연관 사상표**: 가장 최근에 참조된 페이지들만 보관, 나머지는 페이지 사상표에 보관
:::
:::tip 연관 사상표
| 페이지 번호 | 페이지 프레임 번호 |
| :--------: | :---------------: |
|    3       |      5            |
|   ...      |     ...           |
:::


## 세그먼테이션 기법
- 세그먼트: 가상 메모리를 논리적 의미에 맞는 다양한 크기의 세그먼트 단위로 나누어 관리함
  
### 세그먼트 사상표
- 세그먼트 시작주소 : 메모리에서의 시작 위치
- 세그먼트 길이 : 오버플로우 확인용

| 세그먼트 번호 | 보조기억장치 주소 | 세그먼트 길이 | 세그먼트 시작주소 |
| :----------: | :-------------: | :-----------: | :-------------: |
|  ...  | ... | ... | ... |
| 1 | s | 1500 | 1200 |
|  ...  | ... | ... | ... |


## 페이징, 세그먼테이션 혼용기법
- 세그먼테이션의 논리적 장점 + 페이징 기법의 메모리 관리 장점
- 가상 메모리를 세그먼트 단위로, <u>각 세그먼트를 다시 페이지 단위로 분할</u> (**세그먼트 하나당 페이지 사상표 하나!**)
- 메모리는 페이지 프레임으로 분할
- 가상주소는 `v = (s, p, d)` (s=세그먼트번호, p=페이지번호, d=페이지 내 변위)

### 동적 주소 변환 방법
1. 세그먼트 사상표의 시작주소에 가상주소의 세그먼트번호(s)를 더함
2. 위에서 구한 `b+s`의 위치에 들어있는 페이지 사상표의 시작위치를 가져옴
3. `페이지 사상표 시작위치 + 가상주소의 페이지번호(p)`를 해서 페이지 사상표에 들어있는 `페이지 프레임 번호`를 가져옴
4. 해당 페이지 프레임에서 가상주소의 페이지 내 변위(d)를 조합하여 `실주소`를 찾을 수 있게 됨

## 메모리 호출기법
페이지를 어느 시점에 적재할 것인가를 결정

### 요구 페이지 호출기법
한 프로세스의 페이지 요구가 있을 때 요구된 페이지를 메모리로 이동시킴.  
즉, 명령어나 데이터가 실제로 참조될 때(필요할 때) 해당 페이지를 메모리에 적재시킴.  

- 옮길 페이지를 결정하는데 오버헤드를 최소화
- 페이지가 요구될 때 옮겨지기 때문에 메모리로 옮겨진 페이지는 모두 프로세스에 의해 무조건 참조된 것들임
- 프로세스 시작 시점에는 프로세스 진행에 따라 연속적으로 페이지 부재 발생 (성능 저하)

### 예상 페이지 호출기법
현재 요구되지는 않지만 곧 사용될 것으로 예상되는 페이지를 **미리** 메모리로 이동시킴.  
실제 필요한 시점이 되었을 때 프로세스 실행이 단절되지 않음.  

- 예상이 잘못된 경우 메모리 공간을 낭비하게 됨
- 프로세스 시작 시점에 적용하면 성능이 개선됨